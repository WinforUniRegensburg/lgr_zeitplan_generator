<!DOCTYPE>
<html>
<head><title>Table</title></head>
<script type="text/javascript">
window.onload = function() {

	//TODO Problem die Spalten zusammenziehen
	
	//TODO Problem verschiedene Tabellen erstellen für die jeweiligen Tage + Überschriften
	
	//TODO Anpassen zu neuen Datentyp, sobald wir ihn verwenden!

	var json = getEventsJSON();
	var events = JSON.parse(json);
	var table = "<table>"
	
	//evalutate the oldest possible athlete 
	var oldest = 0;
	for (var i = 0; i < events.length; i++) {
		if(oldest < events[i].category.length) {
			oldest = events[i].category.length;
		}
	}
	
	//generate table head
	table = table + "<tr>" + "<th>" + "Zeit" + "</th>";
	//women side
	for (var i = 0; i < oldest; i++) {
		table = table +
		"<th>" + "Frauen " + i + " " + "</th>";
	}
	//men side
	for (var i = 0; i < oldest; i++) {
		table = table +
		"<th>" + "M&auml;nner " + i + " " + "</th>";
	}
	table = table + "</tr>";
	
	//fill in the content
	for (var i = 0; i < events.length; i++) {
	table = table + "<tr>";
	table = table + "<td>" + events[i].time + " Uhr" + "</td>";
		//female side content
		if (events[i].gender == "Frauen") {
			for (var j = 0; j < oldest; j++) {
				if (events[i].category[j]) {
					table = table + "<td>" + events[i].discipline + "</td>";
				} else {
					table = table + "<td></td>";
				}
			} 
			//empty male side
			for (var j = 0; j < oldest; j++) {
				table = table + "<td></td>";
			}
			
		//male side content
		} else {
			//empty female side
			for (var j = 0; j < oldest; j++) {
				table = table + "<td></td>";
			}
			for (var j = 0; j < oldest; j++) {
				if (events[i].category[j]) {
					table = table + "<td>" + events[i].discipline + "</td>";
				} else {
					table = table + "<td></td>";
				}
			}
		}
	table = table + "</tr>";
	}
	table = table + "</table>";
	
	saveTableHTML(table);
	showTable();
}

//puts text in the HTML below "<pre id="displayArea"><pre>"
function showTable() {
    var area = document.getElementById('displayArea');
	area.innerHTML = sessionStorage.getItem('table');
}

//saves the tabel content should be executed before saving the text
function saveTableHTML(table) {
	sessionStorage.getItem('table');
	sessionStorage.setItem('table',table);
}

//returns the events in JSON format from the Cleaner before
function getEventsJSON() {
	return sessionStorage.getItem('events');
}
</script>
<body id="body">
<pre id="displayArea"><pre>
</form>
</body>
</html>