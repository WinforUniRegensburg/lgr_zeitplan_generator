<!DOCTYPE>
<html>
<head><title>Table</title></head>
<script type="text/javascript">
window.onload = function() {

	//TODO Problem die Spalten zusammenziehen
	
	//TODO Anpassen zu neuen Datentyp, sobald wir ihn verwenden!

	var json = getEventsJSON();
	var events = JSON.parse(json);
	
	//TODO sortieren verschieben
	
	//TODO events zusammenziehen
	
	var eventsSplitDays = splitEvents(events);
	
	var pageContent = "";
	
	for (var i = 0; i < eventsSplitDays.length; i++) {
		//generate the headline of the table
		pageContent = pageContent + "<p>" + "<h2>" +
		"Tagesprogramm f√ºr den " + eventsSplitDays[i][0].date + "</h2>" + "</p>";
			
		//generate the table itself
		pageContent = pageContent + "<p>" +
			generateTable(eventsSplitDays[i]) + "</p>";
	}
	
	saveTableHTML(pageContent);
	showTable();
}

function splitEvents(events) {
	var returnArray = [];
	returnArray[0] = [];
	
	var indexReturnArray = 0;
	var currentDate = events[0].date;
	
	for (var i = 0; i<events.length; i++) {		
		if (events[i].date == currentDate) {
			returnArray[indexReturnArray].push(events[i]);
		} else {
			indexReturnArray = indexReturnArray + 1;
			returnArray[indexReturnArray] = [];
			returnArray[indexReturnArray].push(events[i]);
			currentDate = events[i].date;
		}
	}
	return returnArray;
}

function generateTable(events) {
	//------------------- Start Table Algorithm ------------------------------
	// requires an array of Events called "events" as imput 
	// generates output: called table with a table of the input event array
	var table = '<table border="1">';
	
	//evalutate the oldest possible athlete 
	var oldest = 0;
	for (var i = 0; i < events.length; i++) {
		if(oldest < events[i].category.length) {
			oldest = events[i].category.length;
		}
	}
	
	//generate table head
	table = table + "<tr>" + "<th>" + "Zeit" + "</th>";
	//women side
	for (var i = 0; i < oldest; i++) {
		table = table +
		"<th>" + "Frauen " + i + " " + "</th>";
	}
	//men side
	for (var i = 0; i < oldest; i++) {
		table = table +
		"<th>" + "M&auml;nner " + i + " " + "</th>";
	}
	table = table + "</tr>";
	
	//fill in the content
	for (var i = 0; i < events.length; i++) {
	table = table + "<tr>";
	table = table + "<td>" + events[i].time + " Uhr" + "</td>";
		//female side content
		if (events[i].gender == "Frauen") {
			for (var j = 0; j < oldest; j++) {
				if (events[i].category[j]) {
					table = table + "<td>" + events[i].discipline + "</td>";
				} else {
					table = table + "<td></td>";
				}
			} 
			//empty male side
			for (var j = 0; j < oldest; j++) {
				table = table + "<td></td>";
			}
			
		//male side content
		} else {
			//empty female side
			for (var j = 0; j < oldest; j++) {
				table = table + "<td></td>";
			}
			for (var j = 0; j < oldest; j++) {
				if (events[i].category[j]) {
					table = table + "<td>" + events[i].discipline + "</td>";
				} else {
					table = table + "<td></td>";
				}
			}
		}
	table = table + "</tr>";
	}
	table = table + "</table>";
	
	//----------------------------End Table Algorithm--------------------------------------
	
	return table;
}

//puts text in the HTML below "<pre id="displayArea"><pre>"
function showTable() {
    var area = document.getElementById('displayArea');
	area.innerHTML = sessionStorage.getItem('table');
}

//saves the tabel content should be executed before saving the text
function saveTableHTML(table) {
	sessionStorage.getItem('table');
	sessionStorage.setItem('table',table);
}

//returns the events in JSON format from the Cleaner before
function getEventsJSON() {
	return sessionStorage.getItem('events');
}
</script>
<body id="body">
<pre id="displayArea"><pre>
</body>
</html>